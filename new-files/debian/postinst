#!/bin/bash
# postinst script for matchlock
# Sets capabilities on the matchlock binary to allow non-root networking

set -e

case "$1" in
    configure)
        if command -v setcap >/dev/null 2>&1; then
            echo "Setting capabilities for /usr/local/bin/matchlock..."
            setcap cap_net_admin,cap_net_raw+ep /usr/local/bin/matchlock || echo "Warning: Failed to set capabilities on /usr/local/bin/matchlock"
        else
            echo "Warning: setcap not found. Network capabilities for non-root users will not be available."
        fi
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument \`$1'" >&2
        exit 1
    ;;
esac

exit 0
